<!DOCTYPE html>

<html>

<head>
	<meta charset = "UTF-8"/>
	<title>Парголово</title>
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta http-equiv="Cache-Control" content="no-cache" charset="utf-8">
	<link href="static/style.css" rel="stylesheet" type=""/>

	<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>

</head>

<body>
	<header>
		<form method="POST" class="w3-third" id="auth">
			<label for="auth_username">Пользователь:</label>
			<input class="w3-input w3-border w3-round-large"  id="auth_username" type="text" name="username">
			<br/>
			<label for="auth_password">Пароль:</label>
			<input class="w3-input w3-border w3-round-large"  id="auth_password" type="password" name="password">
			<br/>
			<input type="submit" class="w3-button w3-round-large w3-light-grey" value="Войти" onclick="event.preventDefault(); auth()">
		</form>
	</header>
	
	<section id="panel" class="w3-row-padding w3-theme" style="display: none">
		<div id="app" v-bind:onload="init">
			<header>			
				<div class="w3-row w3-padding w3-theme-d2 w3-xlarge">
					<div class="w3-quarter">
						<div class="w3-bar">
							<a href="#" class="w3-bar-item w3-button"><i class="fa fa-bars"></i></a>
						</div>
					</div>
				</div>

				<div class="w3-container w3-padding-32 w3-theme-d1">
					<h1>Емкости ЦКТ</h1>
					<!-- Состояние соединения -->
					<input id="status" class="w3-input w3-border w3-round-large" 
					v-bind:value="connection_watchdog">
					
					<input id="busyTank" name="busyTank" 
					v-on:change="show_only_at_work()"
					class="w3-check" 
					type="checkbox"
					v-model="show_only_coolers_at_work">
					<label for="busyTank">Отобразить ЦКТ, находящиеся в работе</label>
					
					
				</div>
			</header>
			<div class="w3-row-padding w3-theme">

				<div v-for="cooler in coolers" class="w3-third w3-section" v-show="(show_only_coolers_at_work && cooler.is_reg_on) || !show_only_coolers_at_work">
					<div class="w3-card-4 w3-display-container"> 
						<img src="static/images/CKT.png" style="width:100%">
						<div class="w3-padding w3-display-topleft">
							{{cooler.id}}
						</div>
						<div v-on:click="curent_cooler_for_editing = cooler.id" 
						class="w3-display-middle w3-container w3-container w3-card-4"  style="width:65%"
						v-bind:class="{'w3-light-grey': !cooler.is_reg_on, 'w3-green': cooler.is_reg_on}">
							<label>Текущая, °С</label>
							<input readOnly="readOnly" type="number" 
							class="w3-input w3-border w3-round-large" 
							v-bind:class="{'w3-red': cooler.is_reg_alarm && !cooler.is_pv_fault, 'w3-black': cooler.is_pv_fault,'': !cooler.is_pv_fault}"
							v-bind:value="cooler.pv.toFixed(1)" 
							style="font-size: 250%">
							
							<p/>
							<textarea readOnly="readOnly" class="form-control w3-border w3-round-large" rows="5" type="text" style="width:100%"
							v-bind:value="cooler.description" maxlength="200"></textarea>
							
						</div>
					</div>
				</div>

				<datalist id="coolers">
					<option v-for="index in N" v-bind:value="index">
				</datalist>

				<div class="w3-third w3-section">
					<div class="w3-card-4 w3-display-container">
						<img src="static/images/CKT.png" style="width:100%">
						<div class="w3-display-middle w3-container w3-card-4"
						v-bind:class="{'w3-light-grey': !coolers[curent_cooler_for_editing-1].is_reg_on, 
										'w3-green': coolers[curent_cooler_for_editing-1].is_reg_on}">
						
							<label for="unitn">Управление ЦКТ №</label>
							<input class="w3-input w3-border w3-round-large" 
							type="number" id="unitn" list="coolers" min="1" v-bind:max="N"
							v-model.number = "curent_cooler_for_editing"/>
							
							<label for="write_sp">Задание для поддержания температуры:</label>
							<input class="w3-input w3-border w3-round-large" 
							type="number" 
							v-model.number.lazy="coolers[curent_cooler_for_editing-1].sp"/>
							
							<label for="CmdOn CmdOff">Включить/Отключить поддержание температуры:</label>
							<p/>
							<button class="w3-button w3-round-large w3-green" onclick="cmd_on()"> Вкл </button>
							<button class="w3-button w3-round-large w3-red" onclick="cmd_off()">Откл</button>
							<p/>
							
							<label for="ckt_description">Изменить описание:</label>
							<textarea class="form-control w3-border w3-round-large" rows="5" 
							type="text" 
							maxlength="200"
							v-model.text.lazy = "coolers[curent_cooler_for_editing-1].description"></textarea>
							
							<button class="w3-button w3-round-large w3-light-grey" onclick = "send_description()">Изменить описание</button>
						</div>
					</div>
				</div>
			</div>
		</div>
	</section>
		

	<footer class="w3-container w3-theme-d4">
		<p class="w3-large">www.brewale.ru, Парголово, СПб</p>
	</footer>
	
	
	<script src="static/scripts/main.js"></script>
	<script src="static/scripts/utils.js"></script>
	<script src="static/scripts/main_vue.js"></script>

</body>

</html>